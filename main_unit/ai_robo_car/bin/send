#!/usr/bin/env python3

import os
import sys

import serial

from ai_robo_car.packet import Packetizer, Side, Direction

#print(os.environ["PYTHONPATH"])

#os.environ["PYTHONPATH"] = "../ai_robo_car/"

#print(os.environ["PYTHONPATH"])

dev = '/dev/ttyS0'
baud = 9600

ser = serial.Serial(dev)
print('set serial device to: ' + str(dev))

ser.baudrate = baud
print('configure baudrate to: ' + str(baud))

if len(sys.argv) is 4:
    steer_value = float(sys.argv[1]) 
    speed_value = float(sys.argv[2])
    debug_level = 0 #int(sys.argv[3])
    
    if steer_value < 0: # side
        side = Side.LEFT
    else:
        side = Side.RIGHT
    if drive_value < 0:
        direction = Direction.BACKWARD
    else:
        direction = Direction.FORWARD
    Packetizer.write_data(ser, side, direction, debug_level, steer_value, drive_value);
else:
    print('usage <steer_value> <speed_value> <debug_level>')
    
ser.close()
